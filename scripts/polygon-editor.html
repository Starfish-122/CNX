<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>êµ¬ì—­ í´ë¦¬ê³¤ ì¢Œí‘œ ì—ë””í„°</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            body {
                font-family: 'Noto Sans KR', -apple-system, sans-serif;
                display: flex;
                height: 100vh;
            }
            .sidebar {
                width: 350px;
                background: #f8f9fa;
                padding: 20px;
                overflow-y: auto;
                border-right: 2px solid #dee2e6;
            }
            .map-container {
                flex: 1;
                position: relative;
            }
            #map {
                width: 100%;
                height: 100%;
            }
            h1 {
                font-size: 20px;
                margin-bottom: 15px;
                color: #212529;
            }
            .location-selector {
                margin-bottom: 20px;
            }
            select {
                width: 100%;
                padding: 10px;
                font-size: 14px;
                border: 1px solid #ced4da;
                border-radius: 4px;
                background: white;
            }
            .instructions {
                background: #e7f3ff;
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 20px;
                font-size: 13px;
                line-height: 1.6;
            }
            .instructions strong {
                color: #0066cc;
            }
            .points-list {
                background: white;
                border: 1px solid #dee2e6;
                border-radius: 8px;
                padding: 15px;
                margin-bottom: 20px;
                max-height: 200px;
                overflow-y: auto;
            }
            .point-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px;
                margin-bottom: 5px;
                background: #f8f9fa;
                border-radius: 4px;
                font-size: 12px;
                font-family: 'Courier New', monospace;
            }
            .point-item button {
                padding: 4px 8px;
                font-size: 11px;
                background: #dc3545;
                color: white;
                border: none;
                border-radius: 3px;
                cursor: pointer;
            }
            .point-item button:hover {
                background: #c82333;
            }
            .actions {
                display: flex;
                gap: 10px;
                margin-bottom: 20px;
            }
            button {
                flex: 1;
                padding: 10px;
                font-size: 14px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-weight: 500;
            }
            .btn-clear {
                background: #6c757d;
                color: white;
            }
            .btn-clear:hover {
                background: #5a6268;
            }
            .btn-save {
                background: #28a745;
                color: white;
            }
            .btn-save:hover {
                background: #218838;
            }
            .output {
                background: #282c34;
                color: #abb2bf;
                padding: 15px;
                border-radius: 8px;
                font-size: 12px;
                font-family: 'Courier New', monospace;
                white-space: pre-wrap;
                word-break: break-all;
                max-height: 300px;
                overflow-y: auto;
            }
            .output-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 10px;
            }
            .output-header h3 {
                font-size: 14px;
                color: #212529;
            }
            .btn-copy {
                padding: 6px 12px;
                font-size: 12px;
                background: #007bff;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }
            .btn-copy:hover {
                background: #0056b3;
            }
            .status {
                text-align: center;
                padding: 10px;
                margin-bottom: 10px;
                border-radius: 4px;
                font-size: 13px;
                font-weight: 500;
            }
            .status.success {
                background: #d4edda;
                color: #155724;
            }
            .map-info {
                position: absolute;
                top: 10px;
                left: 10px;
                background: white;
                padding: 10px 15px;
                border-radius: 8px;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
                font-size: 13px;
                z-index: 100;
            }
        </style>
    </head>
    <body>
        <div class="sidebar">
            <h1>ğŸ—ºï¸ í´ë¦¬ê³¤ ì¢Œí‘œ ì—ë””í„°</h1>

            <div class="location-selector">
                <select id="locationSelect">
                    <option value="í•œê°•ë¡œê¸¸">í•œê°•ë¡œê¸¸</option>
                    <option value="ìš©ë¦¬ë‹¨ê¸¸">ìš©ë¦¬ë‹¨ê¸¸</option>
                    <option value="ì•„ëª¨ë ˆ / LS">ì•„ëª¨ë ˆ / LS</option>
                    <option value="ë˜ë¯¸ì•ˆ">ë˜ë¯¸ì•ˆ</option>
                    <option value="ì•„ì´íŒŒí¬ëª°">ì•„ì´íŒŒí¬ëª°</option>
                    <option value="ìš©ì‚°ì² ê¸¸">ìš©ì‚°ì² ê¸¸</option>
                </select>
            </div>

            <div class="instructions">
                <strong>ğŸ“ ì‚¬ìš© ë°©ë²•:</strong><br />
                1. ìœ„ì—ì„œ êµ¬ì—­ì„ ì„ íƒí•˜ì„¸ìš”<br />
                2. ì§€ë„ë¥¼ í´ë¦­í•˜ì—¬ í´ë¦¬ê³¤ ê²½ê³„ì ì„ ì¶”ê°€<br />
                3. ìµœì†Œ 3ê°œ ì´ìƒì˜ ì ì„ ì°ìœ¼ì„¸ìš”<br />
                4. "ì €ì¥" ë²„íŠ¼ì„ ëˆŒëŸ¬ ì½”ë“œ ìƒì„±<br />
                5. ìƒì„±ëœ ì½”ë“œë¥¼ ë³µì‚¬í•˜ì—¬ constants.tsì— ë¶™ì—¬ë„£ê¸°
            </div>

            <div id="status"></div>

            <h3 style="font-size: 14px; margin-bottom: 10px">
                ì„ íƒí•œ ì  (<span id="pointCount">0</span>ê°œ)
            </h3>
            <div class="points-list" id="pointsList"></div>

            <div class="actions">
                <button class="btn-clear" onclick="clearPoints()">ëª¨ë‘ ì§€ìš°ê¸°</button>
                <button class="btn-save" onclick="savePolygon()">ì €ì¥</button>
            </div>

            <div class="output-header">
                <h3>ğŸ“‹ ìƒì„±ëœ ì½”ë“œ</h3>
                <button class="btn-copy" onclick="copyToClipboard()">ë³µì‚¬</button>
            </div>
            <div class="output" id="output">// ì§€ë„ë¥¼ í´ë¦­í•˜ì—¬ í´ë¦¬ê³¤ ê²½ê³„ë¥¼ ì„¤ì •í•˜ì„¸ìš”</div>
        </div>

        <div class="map-container">
            <div class="map-info">
                <strong>ğŸ¯ í˜„ì¬ êµ¬ì—­:</strong> <span id="currentLocation">í•œê°•ë¡œê¸¸</span><br />
                <strong>ğŸ“ í´ë¦­í•œ ì :</strong> <span id="clickCount">0</span>ê°œ
            </div>
            <div id="map"></div>
        </div>

        <script
            type="text/javascript"
            src="//dapi.kakao.com/v2/maps/sdk.js?appkey=5beb8d010f9c2f7fe60f99489c4effa3"
        ></script>
        <script>
            // í™˜ê²½ ë³€ìˆ˜ì—ì„œ API í‚¤ ê°€ì ¸ì˜¤ê¸° (ê°œë°œ ì‹œ)
            const API_KEY = '5beb8d010f9c2f7fe60f99489c4effa3'; // .env íŒŒì¼ì˜ NEXT_PUBLIC_KAKAO_MAP_KEYë¡œ êµì²´í•˜ì„¸ìš”

            let map;
            let polygon = null;
            let points = [];
            let markers = [];
            const polygonData = {};

            // ì´ˆê¸° ìœ„ì¹˜ (ìš©ì‚° ì¤‘ì‹¬)
            const DEFAULT_CENTER = { lat: 37.532, lng: 126.965 };

            // ì§€ë„ ì´ˆê¸°í™”
            function initMap() {
                const container = document.getElementById('map');
                const options = {
                    center: new kakao.maps.LatLng(DEFAULT_CENTER.lat, DEFAULT_CENTER.lng),
                    level: 4,
                };

                map = new kakao.maps.Map(container, options);

                // ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸
                kakao.maps.event.addListener(map, 'click', function (mouseEvent) {
                    const latlng = mouseEvent.latLng;
                    addPoint(latlng.getLat(), latlng.getLng());
                });

                console.log('âœ… ì§€ë„ ì´ˆê¸°í™” ì™„ë£Œ');
            }

            // ì  ì¶”ê°€
            function addPoint(lat, lng) {
                const point = {
                    lat: parseFloat(lat.toFixed(4)),
                    lng: parseFloat(lng.toFixed(4)),
                };
                points.push(point);

                // ë§ˆì»¤ ì¶”ê°€
                const marker = new kakao.maps.Marker({
                    position: new kakao.maps.LatLng(lat, lng),
                    map: map,
                });
                markers.push(marker);

                updatePointsList();
                updatePolygon();
                updateClickCount();
            }

            // ì  ëª©ë¡ ì—…ë°ì´íŠ¸
            function updatePointsList() {
                const listDiv = document.getElementById('pointsList');
                listDiv.innerHTML = points
                    .map(
                        (p, i) => `
                <div class="point-item">
                    <span>${i + 1}. lat: ${p.lat}, lng: ${p.lng}</span>
                    <button onclick="removePoint(${i})">ì‚­ì œ</button>
                </div>
            `
                    )
                    .join('');

                document.getElementById('pointCount').textContent = points.length;
            }

            // ì  ì œê±°
            function removePoint(index) {
                points.splice(index, 1);

                // ë§ˆì»¤ ì œê±°
                if (markers[index]) {
                    markers[index].setMap(null);
                }
                markers.splice(index, 1);

                updatePointsList();
                updatePolygon();
                updateClickCount();
            }

            // ëª¨ë“  ì  ì§€ìš°ê¸°
            function clearPoints() {
                points = [];
                markers.forEach((m) => m.setMap(null));
                markers = [];

                if (polygon) {
                    polygon.setMap(null);
                    polygon = null;
                }

                updatePointsList();
                updateClickCount();
                document.getElementById('output').textContent =
                    '// ì§€ë„ë¥¼ í´ë¦­í•˜ì—¬ í´ë¦¬ê³¤ ê²½ê³„ë¥¼ ì„¤ì •í•˜ì„¸ìš”';
            }

            // í´ë¦¬ê³¤ ì—…ë°ì´íŠ¸
            function updatePolygon() {
                // ê¸°ì¡´ í´ë¦¬ê³¤ ì œê±°
                if (polygon) {
                    polygon.setMap(null);
                }

                // 3ê°œ ì´ìƒì˜ ì ì´ ìˆì„ ë•Œë§Œ í´ë¦¬ê³¤ ìƒì„±
                if (points.length >= 3) {
                    const path = points.map((p) => new kakao.maps.LatLng(p.lat, p.lng));

                    polygon = new kakao.maps.Polygon({
                        map: map,
                        path: path,
                        strokeWeight: 3,
                        strokeColor: '#0066cc',
                        strokeOpacity: 1,
                        fillColor: '#0080ff',
                        fillOpacity: 0.3,
                    });
                }
            }

            // í´ë¦­ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            function updateClickCount() {
                document.getElementById('clickCount').textContent = points.length;
            }

            // í´ë¦¬ê³¤ ì €ì¥
            function savePolygon() {
                const location = document.getElementById('locationSelect').value;

                if (points.length < 3) {
                    showStatus('âŒ ìµœì†Œ 3ê°œ ì´ìƒì˜ ì ì„ ì¶”ê°€í•˜ì„¸ìš”', false);
                    return;
                }

                polygonData[location] = [...points];

                // TypeScript ì½”ë“œ ìƒì„±
                const code = generateCode(location);
                document.getElementById('output').textContent = code;

                showStatus(`âœ… ${location} í´ë¦¬ê³¤ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤`, true);
            }

            // ì½”ë“œ ìƒì„±
            function generateCode(location) {
                const pointsCode = points
                    .map((p) => `        { lat: ${p.lat}, lng: ${p.lng} },`)
                    .join('\n');

                return `    // ${location}
    ${location}: [
${pointsCode}
    ],`;
            }

            // ì „ì²´ ì½”ë“œ ìƒì„±
            function generateAllCode() {
                const locations = Object.keys(polygonData);
                if (locations.length === 0) return '// ì €ì¥ëœ í´ë¦¬ê³¤ì´ ì—†ìŠµë‹ˆë‹¤';

                const codes = locations.map((loc) => generateCode(loc)).join('\n');

                return `export const LOCATION_POLYGONS: Record<LocationKey, Coordinates[]> = {
${codes}
} as const;`;
            }

            // í´ë¦½ë³´ë“œì— ë³µì‚¬
            function copyToClipboard() {
                const output = document.getElementById('output').textContent;
                navigator.clipboard
                    .writeText(output)
                    .then(() => {
                        showStatus('ğŸ“‹ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤', true);
                    })
                    .catch(() => {
                        showStatus('âŒ ë³µì‚¬ ì‹¤íŒ¨', false);
                    });
            }

            // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
            function showStatus(message, success) {
                const statusDiv = document.getElementById('status');
                statusDiv.textContent = message;
                statusDiv.className = `status ${success ? 'success' : 'error'}`;

                setTimeout(() => {
                    statusDiv.textContent = '';
                    statusDiv.className = 'status';
                }, 3000);
            }

            // êµ¬ì—­ ë³€ê²½ ì´ë²¤íŠ¸
            document.getElementById('locationSelect').addEventListener('change', function () {
                const location = this.value;
                document.getElementById('currentLocation').textContent = location;

                // ê¸°ì¡´ í´ë¦¬ê³¤ì´ ì €ì¥ë˜ì–´ ìˆìœ¼ë©´ ë¶ˆëŸ¬ì˜¤ê¸°
                if (polygonData[location]) {
                    clearPoints();
                    points = [...polygonData[location]];

                    // ë§ˆì»¤ ì¬ìƒì„±
                    points.forEach((p) => {
                        const marker = new kakao.maps.Marker({
                            position: new kakao.maps.LatLng(p.lat, p.lng),
                            map: map,
                        });
                        markers.push(marker);
                    });

                    updatePointsList();
                    updatePolygon();
                    updateClickCount();

                    const code = generateCode(location);
                    document.getElementById('output').textContent = code;
                } else {
                    clearPoints();
                }
            });

            // í˜ì´ì§€ ë¡œë“œ ì‹œ ì§€ë„ ì´ˆê¸°í™”
            window.onload = function () {
                // API í‚¤ í™•ì¸
                if (API_KEY === 'YOUR_APP_KEY') {
                    alert(
                        'âš ï¸ scripts/polygon-editor.html íŒŒì¼ì˜ API_KEYë¥¼ ì‹¤ì œ ì¹´ì¹´ì˜¤ë§µ API í‚¤ë¡œ êµì²´í•˜ì„¸ìš”!\n\n.env.local íŒŒì¼ì˜ NEXT_PUBLIC_KAKAO_MAP_KEY ê°’ì„ ì‚¬ìš©í•˜ì„¸ìš”.'
                    );
                }

                initMap();
            };
        </script>
    </body>
</html>
